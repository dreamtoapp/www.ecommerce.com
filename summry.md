بالتأكيد، إليك ملخص شامل ومُنظم لمعلومات المشروع بناءً على المصادر التي قدمتها، مُنسق كملف Markdown باللغة العربية ليكون مرجعك الرئيسي.

```markdown
# ملخص شامل لمشروع منصة التجارة الإلكترونية

يهدف هذا المستند إلى تقديم ملخص شامل ومُنظم لمعلومات المشروع بناءً على المصادر المقدمة، ليكون مرجعاً أساسياً يُعتمد عليه في التطوير.

## 🚀 خطة التطوير وترتيب الأولويات

خطة تطوير المتجر لمنافسة منصات مثل سلة وشوبيفاي مُفصلة في مجلد يحتوي على ملفات لكل ميزة رئيسية. يتم ترتيب الأولويات لضمان التطوير الفعال.

**ترتيب الأولويات المُقترح:**
1.  **التحليلات والتقارير الذكية**
2.  **حملات وأتمتة تسويقية**
3.  **دعم تطبيق جوال**
4.  **تخصيص التصميم والقوالب**
5.  **التكاملات الخارجية**
6.  **نظام مراجعات وتقييمات المنتجات**
7.  **دعم لغات وعملات متعددة**
8.  **تحسين الدعم الفني**
9.  **إدارة مخزون وتنبيهات ذكية**
10. **مزايا متقدمة أخرى**

هناك قائمة تحقق لاحتياجات السوق مرتبة حسب الأهمية، تبدأ بالتحليلات والتقارير الذكية، تليها أتمتة الحملات التسويقية، ثم دعم تطبيق جوال، تخصيص التصميم، التكاملات الخارجية، المراجعات والتقييمات، دعم اللغات والعملات، تحسين الدعم الفني، إدارة المخزون، المزايا المتقدمة، تعدد العملاء، ولوحة التحكم الرئيسية للمنصة.

## 📊 تحسينات التقارير ولوحة التحكم

يوثق مستند خاص التحسينات المستقبلية المقترحة لمجموعة تقارير لوحة تحكم التجارة الإلكترونية.

**أولاً: تحسينات على التقارير الحالية**
*   **دقة بيانات تقرير العروض الترويجية:** الهدف هو التتبع الدقيق لاستخدام العروض الترويجية والمبيعات الناتجة، ويتطلب ذلك تعديل نماذج Order/OrderItem في Prisma لتضمين رابط للعروض المطبقة. تأثير هذا التحسين حاسم لفهم فعالية العروض الترويجية وعائد الاستثمار.
*   **تقرير المخزون - رؤى أعمق:** الهدف هو توفير تحليلات مخزون أكثر شمولاً. الإجراءات المقترحة تشمل إضافة مؤشرات أداء رئيسية مثل إجمالي قيمة المخزون ومعدل دورانه، ورسوم بيانية لمستويات المخزون والمنتجات ذات المخزون المنخفض، بالإضافة إلى فلاتر حسب الفئة والمورد والحالة. تأثير هذا التحسين يشمل تحسين إدارة المخزون، تقليل نفاد المخزون، وقرارات شراء أفضل.
*   **قدرات استكشاف تفصيلية محسنة (Drill-Down):** الهدف هو السماح للمستخدمين بالانتقال من البيانات الموجزة إلى عروض أكثر تفصيلاً بجعل عناصر الرسوم البيانية والجداول قابلة للنقر. التأثير هو استكشاف بيانات أكثر سهولة ووصول أسرع إلى التفاصيل.
*   **وظيفة تصدير متسقة:** الهدف هو السماح للمستخدمين بتصدير البيانات من جميع التقارير ذات الصلة إلى CSV/PDF. التأثير هو تسهيل التحليل والمشاركة.

**ثانياً: تقارير جديدة محتملة**
*   **تقرير أداء السائقين والخدمات اللوجستية:** يهدف إلى تتبع وتحليل كفاءة عمليات التوصيل. يتطلب نقاط بيانات مثل متوسط وقت التسليم ومعدل التسليم في الوقت المحدد، ويتطلب نموذج Driver وتحديثات لـ Order. تأثيره تحسين مسارات التسليم وإدارة أداء السائقين.
*   **تقرير تحليلات العملاء المتقدمة وتقسيمهم:** يهدف إلى توفير رؤى أعمق حول سلوك العملاء وشرائحهم من خلال التقسيم إلى شرائح وتحليل الأفواج وتحليل RFM. تأثيره تمكين التسويق المستهدف وتحسين استراتيجيات الاحتفاظ بالعملاء.
*   **تقرير قنوات التسويق والاكتساب:** يهدف إلى فهم فعالية قنوات التسويق ومصادر حركة المرور، ويتطلب نقاط بيانات مثل مصادر حركة المرور، معدلات التحويل، وتكلفة الاكتساب لكل قناة. تأثيره تحسين الإنفاق التسويقي وفهم مسارات اكتساب العملاء.

**ثالثًا: تحسينات عامة على التقارير**
*   **التحليل المقارن (فترة مقابل فترة):** يسمح بمقارنة بيانات التقرير بالفترات السابقة. تأثيره إبراز الاتجاهات ومجالات الاهتمام بفعالية أكبر.
*   **لوحات تحكم قابلة للتخصيص / قسم "تقاريري":** يسمح للمسؤولين بإنشاء عرض لوحة تحكم مخصص مع مؤشرات الأداء الرئيسية الهامة. تأثيره توفير نظرة عامة مخصصة وفعالة لكل مسؤول.
*   **تنبيهات مدفوعة بالتقارير:** تُخطر المسؤولين استباقيًا بالتغييرات أو المشكلات الهامة بناءً على عتبات محددة. تأثيره يتيح استجابة أسرع لأحداث الأعمال الهامة.

هذه القائمة توفر خارطة طريق لجعل مجموعة التقارير أداة تحليلية أكثر قوة.

## 🔍 تحسين محركات البحث (SEO)

النظام الحالي لإدارة SEO في لوحة التحكم متقدم جداً ويدعم جميع المتطلبات الأساسية والمتقدمة للسوق السعودي.

**نظرة عامة على النظام الحالي:**
*   إدارة مركزية لجميع إعدادات SEO.
*   نموذج خاص لكل كيان لإدخال وتحديث بيانات SEO.
*   دعم كامل للغات مع تخصيص بيانات SEO لكل لغة.
*   تكامل مع Next.js Metadata API وتوليد Sitemap وrobots.txt ديناميكيًا.
*   نموذج Prisma مرن (GlobalSEO) يدعم البيانات المنظمة ووسوم OpenGraph وTwitter.
*   واجهات سهلة الاستخدام مع عرض حالة اكتمال بيانات SEO ودعم التعديل السريع والتنبيهات.

**نقاط القوة:** مرونة عالية، دعم التعدد اللغوي (مهم للسوق السعودي)، تكامل تقني ممتاز، دعم البيانات المنظمة، إدارة مركزية، تحقق من صحة البيانات، توليد تلقائي لـ Sitemap وrobots.txt، ودعم الصور المحسنة.

**نقاط الضعف:** تعقيد زائد في نموذج GlobalSEO، إدارة CRUD معقدة للبيانات المتداخلة، غياب بعض التحسينات التقنية (تتبع Core Web Vitals المباشر، دعم محدود للبيانات المنظمة المتقدمة، pagination SEO)، محدودية في التحليلات العميقة (GA/GSC)، وتكرار بعض الحقول.

**التقييم العام:** 8/10. النظام متقدم ويفوق معظم المنصات المحلية، ولكن هناك بعض التعقيد الزائد وقلة في التحسينات التقنية. الأساس قوي جداً وقابل للتطوير السريع.

**اقتراحات التحسين:**
*   **تبسيط نموذج GlobalSEO:** فصل الحقول المتقدمة أو تبسيط النموذج، وتوحيد الحقول المشتركة. قد يُنظر في استخدام نموذج مُسطح وبسيط لـ SEO عالمي يعمل لأي كيان.
*   **إضافة دعم كامل للبيانات المنظمة:** تطبيق schema.org Product وBreadcrumbList افتراضيًا، ودعم JSON-LD.
*   **تحسين إدارة الصور:** دعم WebP/AVIF تلقائيًا وإضافة structured data للصور.
*   **تحسين SEO للصفحات المتعددة (Pagination):** إضافة rel=prev/next أو النظر في صفحة "View All".
*   **تكامل أعمق مع Google Analytics وSearch Console:** عرض تقارير الأداء والزحف.
*   **مراقبة Core Web Vitals:** إضافة لوحة لمراقبة LCP, CLS, INP مباشرة.
*   **تحسين تجربة المستخدم:** إضافة تنبيهات ذكية عند نقص بيانات SEO (مثل منتج بدون metaTitle) ودعم التعديل الجماعي (Bulk Edit).
*   **مراجعة شاملة للـ canonical URLs:** التأكد من عدم وجود تكرار أو تضارب.
*   **تفعيل تتبع الكلمات المفتاحية والأداء العضوي:** الربط مع أدوات تتبع الكلمات مثل SEMrush/Ahrefs.

**خطة تنفيذ SEO:** تشمل ثلاث مراحل: التأسيس (Sitemap, robots.txt, تحسين الصور, Cache control)، التحسين (Breadcrumb, Structured Data, Core Web Vitals monitoring, SEO analytics)، والتحسين المتقدم (URL multilingual, Automatic meta description, Content optimization tools, SEO A/B testing).

**مقاييس النجاح:** فنية (Core Web Vitals, Crawl stats)، SEO (Organic traffic, SERP rankings)، وأعمال (Conversion rates, Revenue from organic).

**خطة الصيانة:** مهام يومية (مراقبة Core Web Vitals, أخطاء الزحف)، أسبوعية (تحديث Sitemaps, مراجعة robots.txt, تحليل SEO)، وشهرية (تدقيق SEO كامل, تحليل المحتوى, مراجعة فنية, تحليل المنافسين).

## 🛒 إدارة عربة التسوق

التنفيذ الحالي لعربة التسوق يعتمد على التخزين المحلي (Zustand). للتنافس مع المنصات الكبرى وتوفير تجربة مستخدم متسقة عبر الأجهزة، يوصى بشدة بنقل تخزين العربة إلى قاعدة البيانات وربطها بحساب المستخدم.

**مقارنة بين التخزين المحلي وقاعدة البيانات:**
*   **الوصول من عدة أجهزة:** غير ممكن محليًا، ممكن عبر قاعدة البيانات.
*   **فقدان البيانات:** يحدث محليًا عند حذف الكاش أو تغيير الجهاز، دائم عبر قاعدة البيانات.
*   **الأداء:** سريع جدًا محليًا، أبطأ عبر قاعدة البيانات (يتطلب اتصال بالخادم).
*   **التزامن:** غير متزامن محليًا، متزامن عبر قاعدة البيانات.
*   **سهولة التنفيذ:** بسيط محليًا، يحتاج تطوير backend و API لقاعدة البيانات.
*   **المستخدم المجهول:** ممكن محليًا، يتطلب ربط بجلسة أو حساب لقاعدة البيانات.
*   **الأمان:** مكشوف في المتصفح محليًا، محمي في الخادم لقاعدة البيانات.
*   **قابلية التوسع:** محدود محليًا، عالي عبر قاعدة البيانات.

**أفضل الممارسات في الشركات الكبرى (أمازون، نون، جوميا، وول مارت):** جميعها تخزن العربة في قاعدة البيانات وتربطها بحساب المستخدم. عند المستخدم المجهول، يتم التخزين محليًا (كوكيز/LocalStorage)، وعند تسجيل الدخول يتم الدمج مع عربة الحساب في قاعدة البيانات.

**خطة التنفيذ المقترحة للانتقال إلى قاعدة البيانات:**
1.  **تصميم جدول/Collection للعربة:** يتضمن userId و items (مع productId, quantity) و timestamps.
2.  **تطوير API للعربة:** لـ إضافة/تعديل/حذف، جلب العربة للمستخدم، ودمج العربة المحلية عند تسجيل الدخول.
3.  **تحديث الواجهة الأمامية:** لجلب العربة من الخادم عند تسجيل الدخول وإرسال التغييرات إلى الخادم.
4.  **دعم المستخدم المجهول:** استمرار استخدام Zustand/localStorage وتنفيذ منطق الدمج عند تسجيل الدخول.

**المزايا:** تجربة مستخدم متسقة، حماية البيانات من الفقدان، تحليل سلوك المستخدم بشكل أفضل، دعم العروض المخصصة.
**العيوب:** زيادة تعقيد التطوير، زيادة الضغط على قاعدة البيانات، الحاجة لمعالجة حالات التزامن والدمج.

**مراحل تنفيذ تحسين سلة التسوق:** تشمل مراحل للأساس (تحسين مخطط DB، مزامنة أساسية، سلة الضيف، إعداد API)، الميزات المتقدمة (مزامنة في الوقت الفعلي، تسعير محسن، مشاركة سلة، حفظ لوقت لاحق)، والتحسين (أداء، تخزين مؤقت، أمان، اختبار).

**تحسينات أمان السلة:** تشمل تحديد معدل الطلبات، التحقق من صحة تغييرات الأسعار، منع التلاعب بالسلة، ومشاركة آمنة وسرية للبيانات.

## 🛠 المعايير التقنية

النهج المتبع في التطوير يعتمد على مبادئ أساسية ومتطلبات غير قابلة للتفاوض.

**المبادئ الأساسية والمتطلبات غير القابلة للتفاوض:**
*   تطوير يعتمد على **TypeScript أولاً (الوضع الصارم)**.
*   فرض نمط **App Router** في Next.js.
*   هندسة **المكونات الذرية**.
*   **عدم وجود تعديلات بيانات من جانب العميل**.
*   **فحوصات إمكانية الوصول التلقائية**.

**قواعد إنشاء الكود:**
*   يتم استخدام **مكونات الخادم** بشكل افتراضي لجلب البيانات وعرضها.
*   يتم استخدام **مكونات العميل** فقط للتفاعلية.
*   في مكونات الخادم، يتم انتظار params و searchParams، وفي مكونات العميل، يتم استخدام use() hook (لـ Next.js 15+).
*   جميع إجراءات الخادم موجودة في مجلدات actions/.
*   يتم استخدام **Prisma فقط في إجراءات الخادم**، وليس أبدًا في مكونات العميل.
*   يتم **التحقق من صحة جميع مدخلات المستخدم** (باستخدام Zod مثلاً) قبل عمليات قاعدة البيانات.
*   يتم إرجاع التواريخ كسلاسل ISO إلى العميل.

**مخطط Prisma واستخدامه:**
*   النماذج (Models) تستخدم PascalCase، والحقول camelCase.
*   جميع العلاقات صريحة وتستخدم مفاتيح خارجية.
*   يتم استخدام التعدادات (Enums) لحقول الحالة/الاختيار.
*   تتم إدارة عمليات الترحيل (Migrations) باستخدام Prisma Migrate.
*   جميع البيانات الحساسة وبيانات اعتماد قاعدة البيانات موجودة في .env، وليست مكتوبة بشكل ثابت.

**التصميم والخطوط:**
*   يتم استخدام Tailwind CSS لجميع التصاميم.
*   يتم تحميل الخطوط باستخدام next/font.
*   يتم استخدام ملفات خطوط .woff2 فقط.

**إدارة الحالة (State Management):**
*   يتم استخدام Zustand أو React context للحالة العامة.
*   لا يوجد تمرير خصائص (prop drilling) لحالة عميقة.

**الأمان والبيئة:**
*   يتم استخدام NextAuth للمصادقة.
*   جميع الأسرار ومفاتيح API مخزنة في .env ولا يتم كشفها للعميل.
*   يتم حماية مسارات API بواسطة برمجيات وسيطة (middleware).
*   يتم فرض HTTPS في بيئة الإنتاج.

**الأداء وإمكانية الوصول:**
*   يتم استخدام `<Image />` من Next.js لجميع الصور.
*   يتم تمكين التحميل الكسول (Lazy loading) للصور والمكونات الثقيلة.
*   يتم إجراء تدقيقات Lighthouse ويجب أن تكون الدرجات > 90 للأداء وإمكانية الوصول.
*   يتم استخدام HTML الدلالي وسمات ARIA.
*   يتم اختبار تباين الألوان والتنقل بلوحة المفاتيح.

**الاختبار وجودة الكود:**
*   تم تكوين وفرض ESLint و Prettier.
*   TypeScript في الوضع الصارم (strict mode).
*   تتم كتابة اختبارات الوحدة والتكامل للمنطق الأساسي.

**التوثيق وقابلية الصيانة:**
*   ملف README.md محدث.
*   جميع الوحدات الرئيسية موثقة.

**الحالة الحالية (إيجابيات/سلبيات):**
*   **الإيجابيات:** استخدام جيد للمجلدات النمطية، Tailwind CSS و Zustand، NextAuth و .env، ESLint, Prettier, TypeScript، مخطط Prisma نظيف، ملفات التوثيق موجودة.
*   **السلبيات:** لا يتم تحميل الخطوط باستخدام next/font، قد لا تتبع بعض المسارات/المكونات اصطلاحات المجلدات بدقة، حاجة لتدقيق فصل مكونات الخادم/العميل، قد تحتاج بعض نماذج/حقول Prisma لتحسينات، قد لا يتم دائمًا إرجاع التواريخ كسلاسل ISO، حاجة للتأكد من التحقق من صحة المدخلات بـ Zod، قد لا يتم إجراء تدقيقات الأداء/إمكانية الوصول بانتظام، تغطية الاختبار قد تكون غير كاملة.

**إذا تم تطبيق جميع عناصر قائمة المراجعة، تكون المزايا:** أقصى أداء وأمان وقابلية للتوسع، لا يوجد تغيير في التخطيط أو FOUT للخطوط، سهولة تأهيل وصيانة المطورين الجدد، هيكل واصطلاحات كود متسقة، أخطاء أقل وتغطية اختبار أفضل، تحسين إمكانية الوصول وتجربة المستخدم، ترقيات أسهل.
**إذا لم يتم التطبيق، تكون العيوب:** خطر تغيير التخطيط وبطء تحميل الخطوط، مشكلات أمان محتملة، صعوبة صيانة وتوسيع الكود، زيادة الديون التقنية، درجات أداء وإمكانية وصول أقل، المزيد من الأخطاء وتجربة مستخدم غير متسقة.

## 📈 تحسين الأداء

تعمل المنصة بشكل مناسب حاليًا ولكن ستستفيد من التحسينات مع نمو البيانات.

**توصيات لأداء الواجهة الأمامية:**
*   تنفيذ ترقيم الصفحات لقوائم المنتجات وسجل الطلبات (أولوية عالية).
*   تحسين تحميل الصور بالتحجيم المناسب والتحميل الكسول (أولوية عالية).
*   تنفيذ استراتيجيات التخزين المؤقت للبيانات (SWR/React Query، التخزين المؤقت من جانب الخادم، التجديد الثابت التدريجي) (أولوية متوسطة).
*   استخدام التحميل الكسول للمكونات الثقيلة.

**توصيات لأداء الواجهة الخلفية:**
*   تحسين استعلامات قاعدة البيانات: إضافة فهارس للحقول التي يتم الاستعلام عنها بشكل متكرر (أولوية عالية)، استخدام الإسقاط لتحديد الحقول المطلوبة فقط، تنفيذ تحسين الاستعلام للاستعلامات المعقدة.
*   تنفيذ تحديد معدل طلبات API (API Rate Limiting) (أولوية متوسطة).
*   تنفيذ ترويسات التخزين المؤقت للموارد الثابتة أو شبه الثابتة.
*   تحسين قاعدة البيانات (أولوية منخفضة): النظر في تجزئة قاعدة البيانات، استخدام نسخ متماثلة للقراءة، تنفيذ تجميع الاتصالات.

**توصيات للمراقبة والتحسين:**
*   تنفيذ مراقبة الأداء: إضافة مراقبة Core Web Vitals، إعداد مقاييس أداء من جانب الخادم، مراقبة أداء استعلامات قاعدة البيانات (أولوية متوسطة).
*   إعداد تتبع الأخطاء والإبلاغ عنها (أولوية منخفضة).
*   إجراء تدقيقات أداء منتظمة (Lighthouse)، مراجعة استعلامات قاعدة البيانات البطيئة، تحليل أحجام الحزم.

## 💾 صيانة قاعدة البيانات وتغيير المخطط

خطة مقترحة لتنفيذ إجراءات صيانة قوية لقاعدة البيانات وعملية واضحة للتعامل مع تغييرات المخطط. المنصة تستخدم Prisma مع MongoDB.

**مهام صيانة قاعدة البيانات المقترحة:**
1.  **التحقق من صحة المخطط والمزامنة:** ضمان التزام البيانات بمخطط Prisma وتطوير إجراءات للمزامنة.
2.  **تنظيف البيانات:** تحديد وتنفيذ عمليات لإزالة السجلات غير المستخدمة أو المتضاربة.
3.  **تحسين الفهارس:** تحليل أداء الاستعلامات وتنفيذ إجراءات لإنشاء أو تعديل الفهارس.
4.  **مراقبة الأداء:** دمج أدوات لمراقبة مقاييس أداء قاعدة البيانات وإعداد تنبيهات.
5.  **النسخ الاحتياطي والاستعادة:** إنشاء إجراءات آلية للنسخ الاحتياطي لـ MongoDB وتحديد إجراءات الاستعادة.

**خطة التنفيذ لمهام الصيانة:** تطوير سكربتات/وظائف، دمجها في لوحة التحكم (/dashboard/maintenance)، تنفيذ تسجيل مفصل، واختبارها في بيئة تدريجية.

**عملية تغيير مخطط قاعدة البيانات:**
1.  **تحديد التغيير:** توثيق التغيير المطلوب بوضوح.
2.  **تحديث مخطط Prisma:** تعديل ملف prisma/schema.prisma.
3.  **توليد وتطبيق الترحيلات (Migrations):** استخدام Prisma Migrate، مراجعة السكربت المُولد، وتطبيقه على البيئات المختلفة.
4.  **تحديث كود التطبيق:** تعديل الكود لاستخدام الحقول الجديدة.
5.  **الاختبار:** اختبار التطبيق بعد التغييرات.
6.  **النشر:** نشر الكود المحدث وتطبيق الترحيل على بيئات الإنتاج.

## 📄 تحسينات سير الطلب والإدارة

بناءً على مراجعة سير الطلب، هناك عدة مجالات للتحسين.

**النقاط البارزة للتنفيذ الحالي:** (غير مفصلة في المصادر المقدمة، ولكن يشار إلى وجودها).

**مجالات التحسين المحتملة:**
*   **عملية الدفع (Checkout):** إضافة التحقق من صحة البيانات من جانب الخادم، دمج بوابة دفع (خطوة حاسمة تالية)، تنفيذ الدفع للضيوف، تحسين إدارة العناوين، وتقديم ملخص طلب واضح للتأكيد.
*   **إدارة الطلبات (لوحة تحكم المسؤول):** عرض تفصيلي للطلب الواحد (صفحة/مودال)، وظيفة تحديث حالة الطلب، تعيين السائقين للطلبات (ميزة مطلوبة)، تحديثات في الوقت الفعلي لقائمة الطلبات، وتحسين البحث والتصفية.
*   **نموذج البيانات والإجراءات (Actions):** استخدام enum لحالات الطلب في مخطط Prisma (تم تنفيذه لاحقًا)، إعادة هيكلة creatOrder.ts (بناءً على تعليقات TODO)، وتنفيذ معالجة أخطاء أكثر تحديدًا.

**حالة الطلب:** تم بنجاح إعادة هيكلة إدارة حالة الطلب باستخدام enum مُحدد الأنواع (OrderStatus Enum) بدلاً من سلاسل نصية. يشمل هذا التغيير تحديث مخطط قاعدة البيانات، مكونات واجهة المستخدم، منطق الأعمال، وترحيل البيانات الموجودة.
**المزايا:** أمان الأنواع (Type Safety)، قابلية صيانة محسنة، تجربة مطور أفضل، واجهة مستخدم متسقة، ودعم RTL مناسب.
**المشاكل التي تم إصلاحها:** أخطاء PrismaClientValidationError بسبب استخدام سلاسل نصية بدلاً من enum في بعض الاستعلامات. تم إصلاحها في ملفات مثل lib/dashboardSummary.ts وإجراءات أخرى.
**تحسينات مستقبلية لحالة الطلب:** إضافة حالات طلب أكثر دقة، تطبيق التحقق من انتقال الحالة، تتبع سجل الحالة، ومكون مرئي لتسلسل الحالة، وإشعارات تعتمد على الحالة.
**دعم RTL لحالة الطلب:** تم تطبيق دعم RTL لعرض حالة الطلب باستخدام إرشادات محددة مثل استخدام dir="rtl"، rtl:flex-row-reverse، rtl:space-x-reverse، واستخدام cn(). تم تحديث مكونات مثل OrderCard و OrderStatusBadge لدعم RTL.

**التوصية:** دمج جميع المستخدمين (عملاء، سائقين، إلخ) في جدول User واحد مع حقل role هو الحل الأمثل والأكثر احترافية. هذا يسهل التطوير، يقلل التكرار، ويجعل النظام أكثر مرونة وقابلية للتوسع. يتطلب ذلك تعديل العلاقات في جدول Order لربطه بـ User كعميل (customerId) وكـ سائق (driverId).

## 📱 تجربة المستخدم النهائي وتحسيناتها (UX)

قائمة مراجعة شاملة لتحسين تجربة المستخدم النهائي تغطي مجالات متعددة.

**مجالات التحسين الرئيسية:**
*   **البحث واكتشاف المنتج:** تنفيذ بحث متقدم (إكمال تلقائي، اقتراحات، تصحيح إملائي)، نظام تصفية محسّن (نطاق السعر، فئات متعددة، فرز، متوفر فقط)، توصيات المنتج ("قد يعجبك أيضًا", "اشترى العملاء أيضًا", "تم عرضه مؤخرًا")، وتحسين التنقل بين الفئات.
*   **تحسين تجربة الجوال:** تحسينات واجهة اللمس، تحسين عملية الدفع عبر الجوال (تقليل حقول النموذج، أنواع إدخال مناسبة، مؤشر تقدم)، وأداء الجوال (تحسين تحميل الصور، تقليل حجم حزمة JS، التحميل الكسول، حالات تحميل هيكلية).
*   **سلة التسوق وعملية الدفع:** الدفع للضيوف، خيارات الدفع (محلي، دولي، محافظ رقمية)، تحسينات تجربة المستخدم (تقليل الحقول، التحقق من صحة العنوان، تحديثات ملخص الطلب)، وتأكيد الطلب (صفحة شاملة، بريد إلكتروني مفصل، تتبع).
*   **تحسينات تفاصيل المنتج:** صور المنتج (معارض متعددة، تكبير، 360 درجة)، معلومات المنتج (واجهة مبوبة، مواصفات، أوصاف قابلة للتوسيع)، عناصر الإثبات الاجتماعي (مراجعات وتقييمات، صور/فيديو للمراجعات)، وتوفر المنتج (مؤشرات واضحة، تاريخ تسليم تقديري، إشعارات إعادة التوفر).
*   **ميزات تفاعل المستخدم:** قائمة الرغبات (إضافة، إدارة، مشاركة، إشعارات بيع)، التخصيص (توصيات منتجات، محتوى مخصص، عمليات بحث محفوظة)، وتحسينات حساب المستخدم (سجل طلبات، دفتر عناوين، تفضيلات).
*   **الثقة والمصداقية:** مؤشرات الأمان (شارات SSL، معلومات الدفع)، الوصول إلى دعم العملاء (شات مباشر، بوت، مركز مساعدة)، ومعلومات السياسة (شحن، إرجاع، ضمان رضا).
*   **الميزات الاجتماعية والمجتمعية:** المشاركة الاجتماعية، المحتوى الذي ينشئه المستخدم (أسئلة وأجوبة، صور العملاء)، وميزات الولاء (نظام نقاط، مزايا عضوية، برنامج إحالة).
*   **تحسين الأداء:** تحسين الصور (متجاوبة، تحميل كسول، WebP)، أداء الواجهة الأمامية (حجم حزمة JS، تقسيم الكود، حالات تحميل هيكلية)، وملاحظات المستخدم (مؤشرات تحميل، إشعارات toast، انتقالات سلسة).
*   **مكاسب سريعة (أولوية فورية):** الدفع للضيوف، ما لا يقل عن طريقتي دفع محليتين، نظام أساسي للمراجعات والتقييمات، تحسين التنقل والأزرار على الجوال، الإكمال التلقائي للبحث، وظيفة قائمة الرغبات، شارات أمان أثناء الدفع، معارض صور منتجات أفضل، أزرار مشاركة اجتماعية، وإشعارات toast لإجراءات السلة.

**القياس والتحقق:** إعداد التحليلات (تتبع الأحداث، مسارات تحويل، خرائط حرارية)، مراقبة الأداء (Core Web Vitals، تتبع الأخطاء، ميزانيات أداء)، وجمع ملاحظات المستخدم (استطلاعات، أداة ملاحظات، اختبار مستخدم، اختبار A/B).

**تحسينات الهيدر (Header):** الهيدر الحالي يتضمن شعار، شريط بحث أساسي، أيقونة سلة، قائمة مستخدم، وقائمة تنقل الفئات. التحسينات المحتملة تشمل تحسينات البحث، الوصول المباشر لقائمة الرغبات في الهيدر الرئيسي (مكسب سريع)، ونظام إشعارات.

**تحسينات الصفحة الرئيسية (Home Page):** مجالات التحسين تشمل تخصيص المحتوى (حسب المستخدم، الموقع)، تجربة المستخدم والأداء (حالات تحميل متقدمة، Infinite Scrolling، زر "Back to Top")، استراتيجية المحتوى والعرض (أقسام مميزة، إبراز الفئات/الماركات)، والتحسينات التقنية و SEO (معالجة أخطاء محسنة، تحسين SEO إضافي، إطار اختبار A/B).

## 🖼 إرشادات الصور

لتحقيق الأداء الأمثل، يجب اتباع إرشادات معينة للصور.

**إرشادات عامة:** استخدام صور متجاوبة، الحفاظ على نسب عرض إلى ارتفاع متسقة، استخدام تنسيقات حديثة مثل WebP، ضغط الصور، وتمكين التحميل الكسول للصور غير الهامة.

**الأبعاد الموصى بها:** صور المنتج 800x800 بكسل، صور العروض الترويجية 1200x628 بكسل، صور البانر 1920x600 بكسل. الأيقونات والشعارات بأبعاد صغيرة مناسبة. صور الخلفية بأبعاد مناسبة.

**نصائح إضافية:** استخدام 72 DPI لصور الويب، استخدام sRGB لملف تعريف اللون، إضافة نص بديل (Alt Text)، واستخدام اصطلاح تسمية وصفي للملفات.

## ✨ ميزات إضافية محددة

*   **حملات وأتمتة تسويقية:** نظام متكامل لإرسال حملات بريدية وSMS، مع أتمتة رسائل الترحيب، التذكير بالسلة، والكوبونات الذكية. أهميته زيادة المبيعات وتقليل فقدان العملاء وتعزيز الولاء.
*   **دعم تطبيق جوال:** تطوير تطبيق جوال للمتجر وتطبيق إدارة للموظفين لزيادة المبيعات وتسهيل المتابعة.
*   **تخصيص التصميم والقوالب:** نظام لتغيير القالب أو تخصيص التصميم من لوحة التحكم بدون الحاجة لمبرمج، مع مكتبة قوالب جاهزة وإمكانية معاينة التغييرات. أهميته إعطاء المتجر مرونة وتميّز العلامة التجارية بسرعة.
*   **نظام مراجعات وتقييمات المنتجات:** تمكين العملاء من تقييم المنتجات وكتابة مراجعات، مع نظام إشراف على التعليقات. أهميته زيادة ثقة العملاء وتحسين ترتيب المنتجات في محركات البحث.
*   **دعم لغات وعملات متعددة:** إتاحة واجهة المتجر والإيميلات بلغات متعددة ودعم عملات مختلفة. أهميته توسيع قاعدة العملاء إقليميًا ودوليًا وتحسين تجربة المستخدم.
*   **دعم تعدد العملاء (Multi-Tenancy):** تحويل النظام ليخدم عدة عملاء (متاجر) مع عزل بيانات كل عميل ديناميكيًا. أهميته تمكين بيع النظام كـ SaaS، مرونة في إدارة إعدادات كل عميل، أمان أعلى، وسهولة التوسع. يتطلب تصميم قاعدة بيانات بربط البيانات بـ clientId وتهيئة الخدمات ديناميكيًا بناءً على العميل. Prisma + MongoDB خيار عملي ومرن لهذا الغرض.
*   **لوحة تحكم رئيسية للمنصة (Master SaaS Dashboard):** لوحة تحكم مركزية لإدارة جميع العملاء (المتاجر)، مع صلاحيات متقدمة لمراقبة الأداء، إدارة الاشتراكات، التحكم في الإعدادات، ودعم فرق العمل. أهميتها تسهيل إدارة المنصة وتمكين فرق الدعم والتسويق وتمركز التحكم.

## ✅ قائمة مراجعة الإطلاق

قائمة مراجعة لإطلاق مشروع التجارة الإلكترونية، مرتبة حسب الأهمية.

**يجب توفرها (حرجة للإطلاق):**
*   جميع الميزات الأساسية منفذة ومختبرة.
*   تكامل الدفع (آمن، جاهز، مختبر).
*   أفضل ممارسات الأمان (متغيرات البيئة، NextAuth، التحقق من صحة الإدخال، تحديد المعدل).
*   معالجة الأخطاء وملاحظات المستخدم.
*   تصميم متجاوب.
*   إمكانية الوصول (WCAG 2.1، تنقل بلوحة المفاتيح، نص بديل للصور).
*   تحسين محركات البحث (SEO) (علامات meta، sitemap.xml، robots.txt).
*   تحسين الأداء (Lighthouse > 90، حجم الحزمة، التحميل الكسول).
*   الاختبار (وحدة، تكامل، E2E).
*   التحليلات والمراقبة.
*   الصفحات القانونية.
*   العلامة التجارية.
*   التوثيق و README.

**تأثير كبير (موصى به بشدة):**
*   دعم متعدد اللغات.
*   إشعارات البريد الإلكتروني.
*   ميزات المشاركة والتفاعل الاجتماعي.
*   لوحات تحكم المسؤول والسائق تعمل بكامل طاقتها.
*   إعداد المستخدم وأدلة المساعدة.

**ميزات متميزة (فروقات سوقية):**
*   تتبع الطلبات والتسليم في الوقت الفعلي.
*   توصيات منتجات مدعومة بالذكاء الاصطناعي.
*   بحث متقدم مع فلاتر/اقتراحات.
*   دعم تطبيق الويب التقدمي (PWA).
*   نظام ولاء/مكافآت.
*   دردشة مباشرة/دعم فني.
*   إشعارات فورية.
*   الدفع بنقرة واحدة.
*   مراجعات/تقييمات العملاء.
*   لوحة تحكم أداء للمسؤولين.
*   نسخ احتياطي آلي وتصدير بيانات.

**نصيحة:** ابدأ بقائمة "يجب توفرها" للإطلاق، ثم انتقل إلى "تأثير كبير" و "ميزات متميزة".

## 🚧 قيود فنية وملاحظات

*   **محدودية ذاكرة التخزين المؤقت لبيانات Next.js:** يوجد حد حجم مدمج يبلغ 2 ميغابايت للإدخالات الفردية في ذاكرة التخزين المؤقت للبيانات في Next.js، مما قد يسبب خطأ عند محاولة تخزين مجموعات بيانات أكبر. حدث هذا الخطأ في مسار الصفحة الرئيسية عند جلب بيانات تجاوزت هذا الحد. الحلول المقترحة هي ترقيم الصفحات وتقسيم البيانات، استخدام العرض الديناميكي (`dynamic = 'no-store'`)، تنفيذ معالج تخزين مؤقت مخصص، تحسين هيكل البيانات، وتقسيم جلب البيانات حسب المكون. يُعد ترقيم الصفحات مهماً بشكل خاص لتطبيقات التجارة الإلكترونية.
*   **تسجيل مراقبة فحص الأنواع (Typecheck Monitoring):** تم بدء مراقبة فحص الأنواع، ويتم تسجيل الأخطاء والحلول. تم مواجهة خطأ في البناء بسبب ملف مفقود (`@/lib/cloudinary`)، مما أثر على إجراءات في لوحة التحكم تتعلق بالفئات والسائقين. الخطوات التالية تتضمن استعادة أو إنشاء الملف المفقود وإعادة البناء.

## 🤖 إرشادات شريك التدريب البرمجي بالذكاء الاصطناعي

تم تحديد إرشادات لدوري كشريك فكري في البرمجة. يتضمن ذلك تحليل الافتراضات، تقديم وجهات نظر معارضة، اختبار المنطق، عرض حلول بديلة، وإعطاء الأولوية للصحة على الموافقة. الهدف هو دفع المستخدم نحو تصميم أفضل ووضوح ومتانة أقوى، والإشارة إلى الممارسات السيئة أو التجريدات الضعيفة. يتطلب هذا التحقق من المكونات ذات الصلة ومخطط Prisma قبل تنفيذ التحديثات، والحفاظ على الكود بسيطًا وواضحًا.
```

لا يمكنني تعديل الملفات مباشرة، ولكن يمكنني تقديم محتوى مقترح لإضافته إلى قسم في ملف Markdown باللغة العربية بعنوان "get important in arabic" بناءً على المعلومات الموجودة في المصادر.

إليك محتوى مقترح يمكنك إضافته إلى هذا القسم، مع التركيز على النقاط الهامة وأولوياتها للمشروع:

## النقاط الهامة في تطوير المنصة (بناءً على المصادر)

*   **التحليلات والتقارير الذكية** هي الأولوية القصوى لمنافسة سلة وشوبيفاي. يشمل ذلك تطوير لوحة تحكم تفاعلية تعرض تقارير المبيعات، المنتجات الأكثر مبيعًا، سلوك العملاء، ومصادر الزيارات.
*   من المهم دعم **تصدير البيانات** من التقارير وإضافة **تنبيهات ذكية للأداء**.
*   يجب تحسين دقة بيانات تقرير **العروض الترويجية** لتمكين التتبع الدقيق لفعاليتها.
*   توجد تقارير جديدة محتملة ذات أهمية مثل تقارير **أداء السائقين/اللوجستيات**، **تحليلات العملاء المتقدمة** وتقسيمهم، و**قنوات التسويق**.
*   تُعد **حملات وأتمتة التسويق** ذات أولوية عالية، بما في ذلك نظام حملات بريدية/SMS مدمج ودعم أتمتة مثل رسائل الترحيب وتذكير السلة.
*   يُعد **دعم تطبيق جوال** للمتجر وتطبيق إدارة للموظفين أولوية عالية، مع دعم الإشعارات الفورية.
*   **تخصيص التصميم والقوالب** من لوحة التحكم هو أولوية عالية لمنح المتاجر مرونة وتميز.
*   **التكاملات الخارجية** مع شركات الشحن وبوابات الدفع وبرامج المحاسبة وشبكات التواصل أولوية عالية. تنفيذ طرق دفع محلية وإضافة Apple/Google Pay أولوية فورية.
*   إضافة **نظام مراجعات وتقييمات المنتجات** أولوية عالية لزيادة الثقة ويعتبر مكسب سريع في تحسين تجربة المستخدم.
*   **دعم لغات وعملات متعددة** (خاصة العربية/الإنجليزية) أولوية عالية لتوسيع قاعدة العملاء.
*   **تحسين الدعم الفني** (شات مباشر، مركز مساعدة، نظام تذاكر) أولوية عالية لخدمة العملاء.
*   **إدارة المخزون والتنبيهات الذكية** (تنبيهات انخفاض المخزون، تقارير) أولوية عالية.
*   **مزايا متقدمة** مثل نظام الكوبونات الذكي وأتمتة العمليات ودعم الاشتراكات الدورية أولوية عالية.
*   **دعم تعدد العملاء (Multi-Tenancy)** كمنصة SaaS أولوية عالية، ويتطلب تصميم قاعدة بيانات خاصة وإدارة مركزية وإعدادات لكل عميل.
*   تطوير **لوحة تحكم رئيسية للمنصة (Master SaaS Dashboard)** أولوية عالية لإدارة العملاء، مراقبة الأداء، وإدارة الاشتراكات على مستوى المنصة ككل.
*   فيما يخص **SEO**، يوجد أساس قوي، والأولويات العالية تشمل: تطبيق **البيانات المنظمة (Structured Data)** للمنتجات وفئات BreadcrumbList، **تحسين جلب بيانات SEO** ومركزتها، معالجة **Pagination SEO**، تحسين **صور SEO**، مراجعة **canonical URLs**، و**مراقبة Core Web Vitals**.
*   يجب تخزين بيانات **عربة التسوق في قاعدة البيانات** للمشاريع الاحترافية لتمكين الوصول من عدة أجهزة والمزامنة.
*   تتضمن تحسينات **تدفق وإدارة الطلبات** لوحة تفصيلية للطلب الواحد، تحديثات الحالة، تعيين السائقين، والبحث/التصفية المحسنة. تم refactor حالة الطلب لاستخدام Enum لتحسين Type Safety، مع ملاحظة خطة مقترحة لاستخدام Constant Enum بدلاً من Prisma Enum.
*   يجب دعم **RTL** في واجهة المسؤول وفي مكونات مثل حالات الطلب.
*   لتحسين **الأداء**، الأولويات العالية تشمل: تنفيذ **ترقيم الصفحات** للقوائم الطويلة، تحسين **تحميل الصور** (تحجيم مناسب، تحميل كسول)، وإضافة **فهارس** لحقول قاعدة البيانات المستخدمة بكثرة.

هذه مجرد قائمة بالنقاط الأكثر بروزًا بناءً على الأولويات والمناقشات في المصادر.

----------------------
بالتأكيد، بناءً على طلبك وبالاعتماد على المصادر المقدمة وسجل محادثتنا، إليك ملخص باللغة العربية للنقاط الهامة وأولوياتها في تطوير المنصة، كما وردت في المصادر:

المصادر تُحدد الأولويات العالية لتطوير المنصة بهدف منافسة منصات مثل سلة وشوبيفاي. هذه النقاط هي الأكثر بروزاً بناءً على الأولويات والمناقشات في المصادر.

#### النقاط الهامة والأولويات في تطوير المنصة:

*   **التحليلات والتقارير الذكية** هي الأولوية القصوى لمنافسة سلة وشوبيفاي. هذا يشمل تطوير لوحة تحكم تفاعلية لعرض تقارير المبيعات، المنتجات الأكثر مبيعاً، سلوك العملاء، ومصادر الزيارات.
*   من المهم دعم **تصدير البيانات** من التقارير وإضافة **تنبيهات ذكية للأداء**.
*   يجب تحسين دقة بيانات تقرير **العروض الترويجية** لتمكين التتبع الدقيق لفعاليتها.
*   توجد تقارير جديدة محتملة ذات أهمية مثل تقارير **أداء السائقين/اللوجستيات**، **تحليلات العملاء المتقدمة** وتقسيمهم، و **قنوات التسويق**.
*   تُعد **حملات وأتمتة التسويق** ذات أولوية عالية، بما في ذلك نظام حملات بريدية/SMS مدمج ودعم أتمتة مثل رسائل الترحيب وتذكير السلة.
*   يُعد **دعم تطبيق جوال** للمتجر وتطبيق إدارة للموظفين أولوية عالية، مع دعم الإشعارات الفورية.
*   **تخصيص التصميم والقوالب** من لوحة التحكم هو أولوية عالية لمنح المتاجر مرونة وتميز.
*   **التكاملات الخارجية** مع شركات الشحن وبوابات الدفع وبرامج المحاسبة وشبكات التواصل أولوية عالية. تنفيذ طرق دفع محلية وإضافة Apple/Google Pay أولوية فورية.
*   إضافة **نظام مراجعات وتقييمات المنتجات** أولوية عالية لزيادة الثقة ويعتبر مكسب سريع في تحسين تجربة المستخدم.
*   **دعم لغات وعملات متعددة** (خاصة العربية/الإنجليزية) أولوية عالية لتوسيع قاعدة العملاء.
*   **تحسين الدعم الفني** (شات مباشر، مركز مساعدة، نظام تذاكر) أولوية عالية لخدمة العملاء.
*   **إدارة المخزون والتنبيهات الذكية** (تنبيهات انخفاض المخزون، تقارير) أولوية عالية.
*   **مزايا متقدمة** مثل نظام الكوبونات الذكي وأتمتة العمليات ودعم الاشتراكات الدورية أولوية عالية.
*   **دعم تعدد العملاء (Multi-Tenancy)** كمنصة SaaS أولوية عالية، ويتطلب تصميم قاعدة بيانات خاصة وإدارة مركزية وإعدادات لكل عميل.
*   تطوير **لوحة تحكم رئيسية للمنصة (Master SaaS Dashboard)** أولوية عالية لإدارة العملاء، مراقبة الأداء، وإدارة الاشتراكات على مستوى المنصة ككل.
*   فيما يخص **SEO**، يوجد أساس قوي، والأولويات العالية تشمل: تطبيق **البيانات المنظمة (Structured Data)** للمنتجات وفئات BreadcrumbList، **تحسين جلب بيانات SEO** ومركزتها، معالجة **Pagination SEO**، تحسين **صور SEO**، مراجعة **canonical URLs**، و **مراقبة Core Web Vitals**.
*   يجب تخزين بيانات **عربة التسوق في قاعدة البيانات** للمشاريع الاحترافية لتمكين الوصول من عدة أجهزة والمزامنة.
*   تتضمن تحسينات **تدفق وإدارة الطلبات** لوحة تفصيلية للطلب الواحد، تحديثات الحالة، تعيين السائقين، والبحث/التصفية المحسنة. تم refactor حالة الطلب لاستخدام Enum لتحسين Type Safety، مع ملاحظة خطة مقترحة لاستخدام Constant Enum بدلاً من Prisma Enum.
*   يجب دعم **RTL** في واجهة المسؤول وفي مكونات مثل حالات الطلب.
*   لتحسين **الأداء**، الأولويات العالية تشمل: تنفيذ **ترقيم الصفحات** للقوائم الطويلة، تحسين **تحميل الصور** (تحجيم مناسب، تحميل كسول)، وإضافة **فهارس** لحقول قاعدة البيانات المستخدمة بكثرة.