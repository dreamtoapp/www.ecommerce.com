# تقرير: دمج جداول العملاء والسائقين في جدول المستخدمين (User Table)

## الوضع الحالي
- يوجد لديك جدول User عام يحتوي على جميع بيانات المستخدمين (عملاء، سائقين، إلخ) مع حقل role لتحديد نوع المستخدم.
- يوجد أيضًا جدول Driver منفصل مرتبط بالطلبات.
- الطلبات (Order) مرتبطة بـ User (كعميل) وأحيانًا بـ Driver.

## المقترح
- إزالة جدول Driver وجدول Customer (إن وجد) والاعتماد فقط على جدول User مع استخدام حقل role (مثلاً: 'customer', 'driver', 'admin').
- ربط الطلبات (Order) بـ User مرتين: مرة كعميل (customerId) ومرة كسائق (driverId).

---

## المزايا
- **تبسيط قاعدة البيانات**: جميع المستخدمين في جدول واحد، يسهل إدارة الصلاحيات والبحث والتقارير.
- **إدارة مركزية للبيانات**: تحديث بيانات المستخدم (اسم، هاتف، صورة...) يتم في مكان واحد.
- **سهولة التوسع**: إضافة أنواع مستخدمين جدد (مندوب، مدير...) فقط بتغيير قيمة role.
- **توافق مع أفضل الممارسات**: معظم الأنظمة الكبيرة (Amazon, Uber, Noon) تستخدم جدول مستخدم موحد مع role.
- **سهولة الربط مع أنظمة المصادقة (Auth)**: تسجيل الدخول/الخروج/تغيير كلمة المرور موحد.

---

## العيوب
- **تداخل البيانات**: بعض الحقول قد لا تكون منطقية لكل الأدوار (مثلاً: عنوان السائق غير مهم).
- **الحاجة للتحقق من role في كل استعلام**: عند جلب السائقين فقط أو العملاء فقط.
- **تغيير في الكود الحالي**: ستحتاج لتعديل الكود في كل مكان كان يعتمد على Driver أو Customer كنماذج منفصلة.

---

## خطة التنفيذ
1. إضافة حقل role في جدول User (إذا لم يكن موجودًا).
2. نقل بيانات السائقين والعملاء إلى جدول User وتحديد role لكل مستخدم.
3. تعديل العلاقات في جدول Order:
   - customerId → يشير إلى User حيث role = 'customer'
   - driverId → يشير إلى User حيث role = 'driver'
4. حذف جدول Driver نهائيًا بعد التأكد من نقل البيانات.
5. تحديث الكود في backend/frontend ليعتمد على User مع role.
6. إضافة فهارس (Indexes) على حقل role لتسريع الاستعلامات.

---

## حالات خاصة
- **سائق هو أيضًا عميل**: يمكن أن يكون للمستخدم أكثر من role أو role مركب (مثلاً: ['driver', 'customer']).
- **صلاحيات خاصة**: يمكن إضافة جدول Roles منفصل إذا احتجت صلاحيات معقدة.

---

## مقارنة مع شركات كبرى
- **Amazon/Noon/Uber**: جميعهم يستخدمون جدول مستخدم موحد مع role أو نوع المستخدم، ويعتمدون على علاقات متعددة لنفس الجدول (self-relation).
- **سهولة التوسع**: إضافة أنواع مستخدمين أو صلاحيات جديدة يتم بسهولة دون تغيير في بنية قاعدة البيانات.

---

## التوصية
- يوصى بشدة بالاعتماد على جدول User موحد مع role، وحذف الجداول المنفصلة للسائقين والعملاء.
- هذا يسهل التطوير، ويقلل التكرار، ويجعل النظام أكثر مرونة وقابلية للتوسع.

---

> **ملخص:**
> دمج جميع المستخدمين في جدول واحد مع role هو الحل الأمثل والأكثر احترافية، ويوافق أفضل الممارسات في الأنظمة الكبيرة.
